# 更新日志

## [1.0.0] - 2025-10-18

### ✨ 新增功能

#### 响应体捕获
- **实现了完整的响应体捕获功能**
  - 支持 XMLHttpRequest 请求的响应体捕获
  - 支持 Fetch API 请求的响应体捕获
  - 自动解析 JSON、HTML、XML、文本等多种格式
  - 大型响应体自动截断保护（默认 5MB）

#### 双层拦截架构
- **页面上下文拦截器** (`interceptor-injected.js`)
  - 运行在页面主上下文，可以访问完整的请求响应数据
  - 拦截原生 XHR 和 Fetch API
  - 通过自定义事件与 Content Script 通信

- **Content Script 桥接** (`interceptor.js`)
  - 负责注入页面拦截器
  - 监听并转发捕获的数据到后台
  - 处理跨上下文通信

### 🔧 优化改进

#### 日志系统
- 移除了过于详细的调试日志
- 保留关键错误日志便于问题诊断
- 优化控制台输出的可读性

#### 数据匹配
- 改进请求匹配算法
- 支持 URL、方法、时间戳多维度匹配
- 5秒时间窗口内的智能匹配

#### 用户体验
- 响应体部分显示更友好的提示信息
- 区分 webRequest 捕获和 Content Script 捕获
- 添加数据源标识

### 📝 文档

- 添加 `IMPLEMENTATION.md` - 详细的实现文档
- 添加 `DEBUG.md` - 调试指南
- 创建 `test/simple-test.html` - 专用测试页面

### 🐛 问题修复

- 修复响应体无法显示的核心问题
- 修复 Content Script 上下文隔离导致的拦截失败
- 修复文件语法错误

### ⚙️ 技术改进

- 使用自定义事件实现跨上下文通信
- 优化消息传递机制
- 改进错误处理

### 📦 构建

- 更新 manifest.json 添加 `web_accessible_resources`
- 优化构建脚本
- 清理临时文件

---

## 使用说明

### 重新加载扩展
1. 打开 `chrome://extensions/`
2. 找到 RequestHelper 扩展
3. 点击刷新按钮

### 测试响应体捕获
1. 访问任意网页
2. 在扩展 popup 中启动捕获
3. 触发 XHR 或 Fetch 请求
4. 在 viewer 页面查看完整的响应体

### 调试
- 打开测试页面：`test/simple-test.html`
- 查看浏览器控制台日志
- 参考 `DEBUG.md` 获取详细调试步骤

---

## 已知限制

1. 仅能捕获页面发起的 XHR/Fetch 请求
2. 无法捕获浏览器内部请求
3. 无法捕获其他扩展的请求
4. 大型响应体会被截断（可配置）

## 下一步计划

- [ ] 添加响应体格式化和语法高亮
- [ ] 支持自定义截断大小
- [ ] 添加请求过滤规则
- [ ] 支持 WebSocket 拦截
- [ ] 性能优化
